"use strict";var __awaiter=this&&this.__awaiter||function(e,s,r,c){return new(r=r||Promise)(function(i,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function a(e){try{o(c.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(n,a)}o((c=c.apply(e,s||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EasyS3=void 0;class EasyS3{constructor(e){this.domain=e.domain,this.apiKeySecret=e.apiKeySecret}upload(e){return __awaiter(this,void 0,void 0,function*(){return Promise.all(e.map(e=>__awaiter(this,void 0,void 0,function*(){const t=yield(yield fetch(this.domain+"/u",{method:"POST",headers:{"Content-Type":"application/json","X-Authorization":"Secret: "+this.apiKeySecret},body:JSON.stringify({fileSize:e.size,fileName:e.name})})).json(),i=new FormData;return i.append("Content-Type",e.type),Object.entries(t.s3.fields).forEach(([e,t])=>{i.append(e,t)}),i.append("file",e),yield fetch(t.s3.url,{method:"POST",body:i}).then(e=>{if(e.ok)return document.dispatchEvent(new CustomEvent("easy_s3_upload_complete",{detail:t.misc})),t.misc})})))})}}exports.EasyS3=EasyS3,exports.default=EasyS3;